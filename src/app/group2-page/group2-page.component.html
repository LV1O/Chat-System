<body>
  <div class="background">
    <header>
      <div class="header">
        <h1>Group 2</h1>
        <h3>Start chatting, {{ username }}!</h3>
      </div>
    </header>

    <nav>
      <div class="sidebar">
        <button class="icon-button" (click)="back()">
          <i class="fas fa-arrow-left"></i> <!-- Back Icon -->
        </button>
        <button class="icon-button">
          <i class="fas fa-user-minus"></i> <!-- Remove Group Icon -->
          <span>Remove Group</span>
        </button>

        <div *ngIf="userRole === 'Super Admin'">
          <button class="icon-button">
            <i class="fas fa-user-plus"></i> <!-- Promote to Group Admin Icon -->
            <span>Promote to Admin</span>
          </button>
          <button class="icon-button">
            <i class="fas fa-user-times"></i> <!-- Remove User Icon -->
            <span>Remove User</span>
          </button>
          <button class="icon-button">
            <i class="fas fa-user-shield"></i> <!-- Upgrade to SuperUser Icon -->
            <span>Upgrade to SuperUser</span>
          </button>
        </div>

        <div *ngIf="userRole === 'Group Admin'">
          <button class="icon-button">
            <i class="fas fa-plus"></i> <!-- Create Channel Icon -->
            <span>Create Channel</span>
          </button>
          <button class="icon-button">
            <i class="fas fa-user-times"></i> <!-- Remove User Icon -->
            <span>Remove User</span>
          </button>
          <button class="icon-button">
            <i class="fas fa-user-slash"></i> <!-- Ban User Icon -->
            <span>Ban User</span>
          </button>
        </div>
      </div>
    </nav>

    <main>
      <div class="content">

        <!-- Display connected peer IDs -->
        <ul>
          <li *ngFor="let peerId of peerList" (click)="calling(peerId)">
            <span>{{ peerId }}</span>
          </li>
        </ul>

        <!-- Video grid for streaming -->
        <div class="video-grid">
          <div *ngFor="let video of videos">
            <video class="video-element" [srcObject]="video.srcObject" controls autoplay [muted]="video.muted"></video>
          </div>
        </div>

        <!-- Message list -->
        <div class="message-list">
          <div *ngFor="let msg of messages" 
               class="message-item" 
               [ngClass]="{'message-sent': msg.sender === username, 'message-received': msg.sender !== username}">
            <div class="message-header">
              <strong>{{ msg.sender }}</strong>
              <small>{{ msg.timestamp | date:'short' }}</small>
              <div class="profile-pic-box" (click)="fileInput.click()">
                <img *ngIf="msg.profileImageUrl" [src]="msg.profileImageUrl" alt="Profile Image" class="profile-image" />
                <input type="file" (change)="onProfileImageSelected($event, msg)" accept="image/*" hidden #fileInput />
              </div>              
            </div>
            <div class="message-bubble">
              {{ msg.messageContent }}
              <!-- Display uploaded image -->
              <img *ngIf="msg.imageUrl" [src]="msg.imageUrl" alt="Uploaded Image" class="uploaded-image" />
              <!-- Trashcan icon for deleting messages -->
              <button class="delete-button" (click)="deleteMessage(msg)">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Input for sending messages and uploading images -->
        <div class="message-input">
          <div class="chat-input-area">
            <button class="icon-button" (click)="streamCamera()" [disabled]="isCallStarted">
              <i class="fas fa-video"></i>
            </button>
            <button class="icon-button" (click)="streamScreen()" [disabled]="isCallStarted">
              <i class="fas fa-desktop"></i>
            </button>
            <button class="icon-button" (click)="endCall()" [disabled]="!isCallStarted">
              <i class="fas fa-phone-slash"></i>
            </button>

            <input type="file" (change)="onFileSelected($event)" accept="image/*" hidden #fileInput />
            <button class="icon-button" (click)="fileInput.click()">
              <i class="fas fa-plus"></i> <!-- Add Image Icon -->
            </button>

            <input type="text" [(ngModel)]="message" placeholder="Type a message!" />
            <button class="icon-button" (click)="submitMessage()">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>

      </div>
    </main>
  </div>
</body>